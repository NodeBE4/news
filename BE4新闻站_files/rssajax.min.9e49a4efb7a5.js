function showRSS(id,RSS){for(var imageTag="<img id='chan_image'",startItemTag="<div id='item'>",startTitle="<h3 id='item_title'>",startLink="<div id='item_link'>",startDescription="<div class='collapse' id='item_content'>",endTag="</div>",properties=new Array("title","link","content","pubDate","copyright"),i=0;i<properties.length;i++)eval("document.getElementById('chan_"+properties[i]+"').innerHTML = ''"),curProp=eval("RSS."+properties[i]),null!=curProp&&eval("document.getElementById('chan_"+properties[i]+"').innerHTML = curProp");document.getElementById("chan_image_link").innerHTML="",RSS.image&&null!=RSS.image.src&&(document.getElementById("chan_image_link").href=RSS.image.link,document.getElementById("chan_image_link").innerHTML=imageTag+" alt='"+RSS.image.description+"' width='"+RSS.image.width+"' height='"+RSS.image.height+"' src='"+RSS.image.url+"' />");var subjects=document.getElementById("sub-"+id),lists=document.createElement("ul");lists.setAttribute("class","nav bd-sidenav"),subjects.innerHTML="",subjects.appendChild(lists),document.getElementById("chan_items").innerHTML="";for(var i=0;i<RSS.items.length;i++){var startContent="<div id='news-"+i+"'>",startTitleClick="<h1 id='item_title-"+i+"' >",pubDate=new Date(RSS.items[i].pubDate),el=document.createElement("div");RSS.items[i]["content:encoded"]?el.innerHTML=RSS.items[i]["content:encoded"]:el.innerHTML=RSS.items[i].content,el.setAttribute("id","news-"+i);var imgs=el.getElementsByTagName("img");for(j=0;j<imgs.length;j++)imgs[j].classList.add("img-fluid");if(item_html="<div style='display:none;' id='article-"+i+"'>",item_html+=null==RSS.items[i].title?"":startTitleClick+RSS.items[i].title+"</h1>",isNaN(pubDate.getTime()))var pubDateString=RSS.items[i].pubDate,pubDateTimeString=null==pubDateString?"":pubDateString.substring(0,10);else var pubDateString=pubDate.toISOString().substring(0,19),pubDateTimeString=pubDateString;item_html+=null==RSS.items[i].pubDate?"":"<span style='font-size:12px;color:gray;'>发表于:"+pubDateTimeString+" </span>";var item_link_a=document.createElement("a");item_link_a.id="item_link-"+i,item_link_a.innerHTML="打开原文",item_link_a.href=null==RSS.items[i].guid?"":RSS.items[i].guid,RSS.items[i].link&&(item_link_a.href=RSS.items[i].link),item_html+="<span style='font-size:12px;'>"+item_link_a.outerHTML+"</span>",item_html+=null==RSS.items[i].content?"":el.outerHTML,item_html+=endTag,document.getElementById("chan_items").innerHTML+=item_html;var li=document.createElement("li");li.setAttribute("id","side-"+i),li.innerHTML=i+1+". "+RSS.items[i].title+". <span style='font-size:10px;'>"+pubDateTimeString+"</span>",li.setAttribute("style","font-size:12px;"),li.setAttribute("onclick","showArticle('"+i+"',"+RSS.items.length+");"),lists.appendChild(li)}return document.getElementById("cnt-"+id).innerHTML=RSS.items.length,showArticle(0,RSS.items.length),!0}function getMyRSS(e,t){var n=document.getElementById(e),l=document.getElementById("sub-"+e),r=document.createElement("img");return l.appendChild(r),l.style.display="block",r.src=document.getElementById("loadergif").src,(new RSSParser).parseURL("https://cors-anywhere.herokuapp.com/"+t,function(t,l){if(t)throw t;var r=n.parentNode.getElementsByTagName("div");for(i=0;i<r.length;i++){var o=r[i],m=document.getElementById("sub-"+o.getAttribute("id"));o.getAttribute("id")!=e&&(m.innerHTML="",m.style.display="none")}showRSS(e,l),document.getElementById("rss-"+e).style.color="gray";var d=document.getElementById("sourcelist");d.appendChild(d.childNodes[0]),d.prepend(document.getElementById(""+e))}),!0}function setActive(e){for(var t=document.getElementById("sourcelist"),i=0;i<t.children.length;i++){var n=t.children[i];e!=n.id?n.classList.remove("active"):n.classList.add("active")}return!0}function toggleSide(e,t){var i=document.getElementById(t);document.getElementById(e);return"none"===i.style.display?(i.style.display="block",replaceButtonText(e,"[ - ]")):(i.style.display="none",replaceButtonText(e,"[ + ]")),!0}function showArticle(e,t){for(i=0;i<t;i++){var n=document.getElementById("article-"+i),l=document.getElementById("side-"+i);i==e?(n.style.display="block",l.style.color="blue"):(n.style.display="none",l.style.color="gray")}return fillAddStoryForm(e),scrollToTop("chan"),!0}function activeArticle(){var e=document.getElementById("chan_items").childNodes.length;if(e<1)return-1;var t=0;for(i=0;i<e;i++){var n=document.getElementById("article-"+i);document.getElementById("side-"+i);"block"==n.style.display&&(t=i)}return{active:t,total:e}}function nextArticle(){var e=activeArticle();if(e.active<0)return!1;document.getElementById("article-"+e.active).style.display="none",document.getElementById("side-"+e.active).style.color="gray";var t=Math.min(e.active+1,e.total-1),i=document.getElementById("article-"+t),n=document.getElementById("side-"+t);return i.style.display="block",n.style.color="blue",fillAddStoryForm(t),scrollToTop("chan"),!0}function prevArticle(){var e=activeArticle();if(e.active<0)return!1;document.getElementById("article-"+e.active).style.display="none",document.getElementById("side-"+e.active).style.color="gray";var t=Math.max(e.active-1,0),i=document.getElementById("article-"+t),n=document.getElementById("side-"+t);return i.style.display="block",n.style.color="blue",fillAddStoryForm(t),scrollToTop("chan"),!0}function fillAddStoryForm(e){var t=document.getElementById("item_title-"+e).innerHTML,i=document.getElementById("item_link-"+e).href;return document.getElementById("id_title").value=t,document.getElementById("id_url").value=i,document.getElementById("id_text").value="",document.getElementById("id_tags").value="",document.getElementById("id_fulltext").checked=!1,!0}function fulltext(){if(document.getElementById("id_fulltext").checked){var e=activeArticle(),t=document.getElementById("news-"+e.active).innerHTML,i=(new TurndownService).turndown(t);document.getElementById("id_text").value=i}else document.getElementById("id_text").value=""}function scrollToTop(e){return document.getElementById(e).scrollTop=0,!0}function resize(){var e=window.innerHeight,t=$("#sitenav").outerHeight(),i=$("#footer").outerHeight(),n=$("#infobar").outerHeight(),l=e-t-i-$("#nav-tips").outerHeight()-$("#nav-tabs").outerHeight(),r=e-t-i-n;document.getElementById("sourcelist").style.height=l+"px",document.getElementById("chan").style.height=r+"px"}function addSource(e,t){return document.getElementById("sourceform").name.value=e,document.getElementById("sourceform").url.value=t,document.getElementById("sourceform").action="/reader/add/",!0}function deleteSource(e,t){return document.getElementById("sourceform").name.value=e,document.getElementById("sourceform").url.value=t,document.getElementById("sourceform").action="/reader/remove/",document.getElementById("sourceform").submit(),!0}function shareSource(e,t){return document.getElementById("sourceform").name.value=e,document.getElementById("sourceform").url.value=t,document.getElementById("sourceform").action="/reader/share/",document.getElementById("sourceform").submit(),!0}function topSource(e,t){return document.getElementById("sourceform").name.value=e,document.getElementById("sourceform").url.value=t,document.getElementById("sourceform").action="/reader/top/",document.getElementById("sourceform").submit(),!0}
