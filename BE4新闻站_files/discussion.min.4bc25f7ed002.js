function toggle(e,t){var n=document.getElementById(t),i=document.getElementById(e).getAttribute("n");"none"===n.style.display?(n.style.display="block",replaceButtonText(e,"[ - ]")):(n.style.display="none",replaceButtonText(e,i?"[ + ] "+i+"评论":"[ + ]"))}function replaceButtonText(e,t){if(document.getElementById){var n=document.getElementById(e);n&&(n.childNodes[0]?n.childNodes[0].nodeValue=t:n.value?n.value=t:n.innerHTML=t)}}function loadDoc(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==this.readyState&&200==this.status&&(document.getElementById(t).innerHTML=this.responseText)},n.open("GET",e,!0),n.send()}function getYTBId(e){var t=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);return t&&11==t[2].length?t[2]:"error"}function loadRemoteArticle(e,t){document.getElementById("submitText");var n=document.getElementById("article");var i=document.createElement("div");if(i.id="temp",n){var r=getYTBId(e);"error"==r?$("#article").load("https://cors-anywhere.herokuapp.com/"+e+" article",function(e,t,r){if("success"==t){i.innerHTML=e;var o=i.querySelector('script[type="application/ld+json"]'),l=i.getElementsByClassName("article")[0],a=i.getElementsByClassName("content")[0],d=i.getElementsByClassName("story-body__inner")[0],m=$(i).find('meta[name="description"]').attr("content");if(n.innerHTML.length>0){removeHtmlStyle(n);var c=(new TurndownService).turndown(n.innerHTML),s=new showdown.Converter;n.innerHTML=s.makeHtml(c)}else if(l){if(removeHtmlStyle(l),l.innerHTML.length>0){c=(new TurndownService).turndown(l.innerHTML),s=new showdown.Converter;n.innerHTML=s.makeHtml(c)}}else if(a){if(removeHtmlStyle(a),a.innerHTML.length>0){c=(new TurndownService).turndown(a.innerHTML),s=new showdown.Converter;n.innerHTML=s.makeHtml(c)}}else if(d&&(removeHtmlStyle(d),d.innerHTML.length>0)){c=(new TurndownService).turndown(d.innerHTML),s=new showdown.Converter;n.innerHTML=s.makeHtml(c)}if(0==n.innerText.length&&o){n.innerHTML="";var u=JSON.parse(o.text);if(i.remove(),u){var g=document.createElement("div");if(g.classList.add("small"),n.appendChild(g),u.author){var h=document.createElement("span");h.innerHTML=u.author.name,g.appendChild(h)}var y=document.createElement("span");y.innerHTML=u.datePublished,g.appendChild(y);var f=document.createElement("div");if(n.appendChild(f),u.image){var p=document.createElement("img");p.src=u.image.url,p.width=u.image.width,p.height=u.image.height,f.appendChild(p)}var v=document.createElement("div");f.appendChild(v),u.description?v.innerHTML=u.description:v.innerHTML=m}else{var w=document.getElementById("main");n.innerHTML="",n.innerHTML=w}}var T=document.getElementsByTagName("img");for(j=0;j<T.length;j++)T[j].classList.add("img-fluid")}}):n.innerHTML='<iframe width="560" height="315" src="//www.youtube.com/embed/'+r+'" frameborder="0" allowfullscreen></iframe>'}else{var o=document.getElementsByTagName("img");for(j=0;j<o.length;j++)o[j].classList.add("img-fluid")}}function limitImgWidth(){var e=document.getElementsByTagName("img");for(j=0;j<e.length;j++)e[j].classList.add("img-fluid")}function removeHtmlStyle(t){var n=["script","style","svg"];for(e=n.length-1;e>=0;e--){var r=t.getElementsByTagName(n[e]);for(i=r.length-1;i>=0;i--)r[i].parentNode.removeChild(r[i])}var o=t.getElementsByTagName("a");for(j=o.length-1;j>=0;j--){var l=o[j].innerText,a=o[j].children;for(k=a.length-1;k>=0;k--){if("IMG"!=a[k].tagName){o[j].innerHTML=l.replace(/(\r\n|\n|\r)/gm,"");break}a[k].style.width="100%;"}}return!0}function replyToItem(e){var t=document.getElementById(e),n=document.getElementById("reply-"+e),i=document.getElementById("cancel-"+e),r=document.getElementById("ignore-"+e),o=document.getElementById("comment-form");t.appendChild(o),o.action="/item/"+e,o.style.display="block",document.getElementById("submit-comment").setAttribute("data-href",r.href),n.parentNode.style.display="none",i.parentNode.style.display=""}function hideReplyForm(e){var t=document.getElementById("reply-"+e),n=document.getElementById("cancel-"+e),i=document.getElementById("comment-form");t.parentNode.style.display="",n.parentNode.style.display="none",i.style.display="none"}jQuery("a").filter(function(){return this.hostname&&this.hostname!==location.hostname}).click(function(e){var t=$(this).attr("href");if(confirm("您正打开外部链接\n"+t))return window.open(t),!1;e.preventDefault()}),$(document).ready(function(e){e(".table-cell").click(function(){window.document.location=e(this).data("href")}),e(".div-cell").click(function(){window.document.location=e(this).data("href")}),limitImgWidth(),e("#submit-comment").click(function(){window.document.location=e(this).data("href")})});
